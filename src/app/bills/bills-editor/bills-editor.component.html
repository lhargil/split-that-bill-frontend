<form *ngIf="billForm" [formGroup]="billForm" (ngSubmit)="onSubmit(billForm)">
    <h2>
        Enter your bill details
    </h2>
    <div>
        <label>
            Place name
            <input type="text" formControlName="establishmentName" />
        </label>
        <div *ngIf="establishmentName.invalid && (establishmentName.dirty || establishmentName.touched)"
            class="invalid-feedback">
            <div *ngIf="establishmentName.errors.required">
                Place name is required.
            </div>
            <div *ngIf="establishmentName.errors.minlength">
                Place name must be at least 3 characters long.
            </div>
        </div>
    </div>
    <div>
        <label>
            When was this
            <select formControlName="billDateYear" (change)="yearChanged($event.target.value)">
                <option *ngFor="let year of datePickerList.years" [value]="year">{{year}}</option>
            </select>
            <select formControlName="billDateMonth" (change)="monthChanged($event.target.value)">
                <option *ngFor="let month of datePickerList.months; let i = index;" [value]="i + 1">{{month}}</option>
            </select>
            <select formControlName="billDateDay">
                <option *ngFor="let day of datePickerList.days" [value]="day">{{day}}</option>
            </select>
        </label>
    </div>
    <div>
        <label>
            What was this all about
            <textarea formControlName="remarks" cols="30" rows="10"></textarea>
        </label>
    </div>
    <div>
        What items did you buy? <button type="button" (click)="addBillItem()">Add new</button><br>
        <div style="font-size: 0.75em;">
            <i>* Discounts are in unit price units</i>
        </div>
        <div style="margin-top: 8px;" formArrayName="billItems" *ngFor="let billItem of billItems.controls; let i = index;">
            <div style="margin-bottom: 8px;" [formGroupName]="i">
                <span>1 </span>
                <input type="text" formControlName="description" placeholder="Description" /> &nbsp;
                <input type="text" formControlName="amount" placeholder="Amount" /> &nbsp;
                <input type="text" formControlName="discount" placeholder="Discount" /> &nbsp;
                <button type="button" (click)="removeBillItem(i)">Remove</button>
                <div class="invalid-feedback" *ngIf="billItems.controls[i].get('description').invalid && (billItems.controls[i].get('description').dirty || billItems.controls[i].get('description').touched)"
                    class="alert alert-danger">
                    <div *ngIf="billItems.controls[i].get('description').errors.required">
                        Description {{i + 1}} is required.
                    </div>
                    <div *ngIf="billItems.controls[i].get('description').errors.minlength">
                        Description {{i + 1}} must be at least 3 characters long.
                    </div>
                </div>
                <div class="invalid-feedback" *ngIf="billItems.controls[i].get('amount').invalid && (billItems.controls[i].get('amount').dirty || billItems.controls[i].get('amount').touched)">
                    <div *ngIf="billItems.controls[i].get('amount').errors.required">
                        Amount {{i + 1}} is required.
                    </div>
                    <div *ngIf="billItems.controls[i].get('amount').errors.notDecimal">
                        Amount {{i + 1}} must be in decimal format.
                    </div>
                </div>
                <div class="invalid-feedback" *ngIf="billItems.controls[i].get('discount').invalid && (billItems.controls[i].get('discount').dirty || billItems.controls[i].get('discount').touched)">
                    Discount {{i + 1}} must be in decimal format.
                </div>
            </div>
        </div>
    </div>
    <div>
        Who were you with?
        <div formArrayName="participants" *ngFor="let participant of participants.controls; let i = index;">
            <label [formGroupName]="i">
                <input type="checkbox" formControlName="selected" />
                {{participant.get('fullname').value}}
            </label>
        </div>
    </div>
    <div>
        Any extra charges? <button type="button" (click)="addExtraCharge()">Add new</button>
        <div style="font-size: 0.75em;">
            <i>** Extra charges are in percentage units</i>
        </div>
        <div style="margin-top: 8px;" formArrayName="extraCharges" *ngFor="let extraCharge of extraCharges.controls; let i = index;">
            <div style="margin-bottom: 8px;" [formGroupName]="i">
                <span>{{i + 1}} </span>
                <input type="text" formControlName="description" placeholder="Description" /> &nbsp;
                <input type="text" formControlName="rate" placeholder="Rate" />%&nbsp;
                <button type="button" (click)="removeExtraCharge(i)">Remove</button>
                <div class="invalid-feedback" *ngIf="extraCharges.controls[i].get('description').invalid && (extraCharges.controls[i].get('description').dirty || extraCharges.controls[i].get('description').touched)"
                    class="alert alert-danger">
                    <div *ngIf="extraCharges.controls[i].get('description').errors.required">
                        Description {{i + 1}} is required.
                    </div>
                    <div *ngIf="extraCharges.controls[i].get('description').errors.minlength">
                        Description {{i + 1}} must be at least 3 characters long.
                    </div>
                </div>
                <div class="invalid-feedback" *ngIf="extraCharges.controls[i].get('rate').invalid && (extraCharges.controls[i].get('rate').dirty || extraCharges.controls[i].get('rate').touched)">
                    <div *ngIf="extraCharges.controls[i].get('rate').errors.required">
                        Rate {{i + 1}} is required.
                    </div>
                    <div *ngIf="extraCharges.controls[i].get('rate').errors.notDecimal">
                        Rate {{i + 1}} must be in decimal format.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <button type="button" (click)="cancelEdit()">Cancel</button> &nbsp;
    <button type="submit" [disabled]="!billForm.valid">Save</button>
</form>

